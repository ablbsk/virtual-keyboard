(()=>{"use strict";const e={row1:[{id:"Backquote",type:"symbol",value:{en:["`","~"],ru:["ё","Ё"]},capslock:{en:!1,ru:!0}},{id:"Digit1",type:"symbol",value:{en:["1","!"],ru:["1","!"]},capslock:{en:!1,ru:!1}},{id:"Digit2",type:"symbol",value:{en:["2","@"],ru:["2",'"']},capslock:{en:!1,ru:!1}},{id:"Digit3",type:"symbol",value:{en:["3","#"],ru:["3","№"]},capslock:{en:!1,ru:!1}},{id:"Digit4",type:"symbol",value:{en:["4","$"],ru:["4",";"]},capslock:{en:!1,ru:!1}},{id:"Digit5",type:"symbol",value:{en:["5","%"],ru:["5","%"]},capslock:{en:!1,ru:!1}},{id:"Digit6",type:"symbol",value:{en:["6","^"],ru:["6","?"]},capslock:{en:!1,ru:!1}},{id:"Digit7",type:"symbol",value:{en:["7","&"],ru:["7","?"]},capslock:{en:!1,ru:!1}},{id:"Digit8",type:"symbol",value:{en:["8","*"],ru:["8","*"]},capslock:{en:!1,ru:!1}},{id:"Digit9",type:"symbol",value:{en:["9","("],ru:["9","("]},capslock:{en:!1,ru:!1}},{id:"Digit0",type:"symbol",value:{en:["0",")"],ru:["0",")"]},capslock:{en:!1,ru:!1}},{id:"Minus",type:"symbol",value:{en:["-","_"],ru:["-","_"]},capslock:{en:!1,ru:!1}},{id:"Equal",type:"symbol",value:{en:["=","+"],ru:["=","+"]},capslock:{en:!1,ru:!1}},{id:"Backspace",type:"special",value:"Backspace"}],row2:[{id:"Tab",type:"special",value:"Tab"},{id:"KeyQ",type:"symbol",value:{en:["q","Q"],ru:["й","Й"]},capslock:{en:!0,ru:!0}},{id:"KeyW",type:"symbol",value:{en:["w","W"],ru:["ц","Ц"]},capslock:{en:!0,ru:!0}},{id:"KeyE",type:"symbol",value:{en:["e","E"],ru:["у","У"]},capslock:{en:!0,ru:!0}},{id:"KeyR",type:"symbol",value:{en:["r","R"],ru:["к","К"]},capslock:{en:!0,ru:!0}},{id:"KeyT",type:"symbol",value:{en:["t","T"],ru:["е","Е"]},capslock:{en:!0,ru:!0}},{id:"KeyY",type:"symbol",value:{en:["y","Y"],ru:["н","Н"]},capslock:{en:!0,ru:!0}},{id:"KeyU",type:"symbol",value:{en:["u","U"],ru:["г","Г"]},capslock:{en:!0,ru:!0}},{id:"KeyI",type:"symbol",value:{en:["i","I"],ru:["ш","Ш"]},capslock:{en:!0,ru:!0}},{id:"KeyO",type:"symbol",value:{en:["o","O"],ru:["щ","Щ"]},capslock:{en:!0,ru:!0}},{id:"KeyP",type:"symbol",value:{en:["p","P"],ru:["з","З"]},capslock:{en:!0,ru:!0}},{id:"BracketLeft",type:"symbol",value:{en:["[","{"],ru:["х","Х"]},capslock:{en:!1,ru:!0}},{id:"BracketRight",type:"symbol",value:{en:["]","}"],ru:["ъ","Ъ"]},capslock:{en:!1,ru:!0}},{id:"Delete",type:"special",value:"Delete"}],row3:[{id:"CapsLock",type:"special",value:"CapsLock"},{id:"KeyA",type:"symbol",value:{en:["a","A"],ru:["ф","Ф"]},capslock:{en:!0,ru:!0}},{id:"KeyS",type:"symbol",value:{en:["s","S"],ru:["ы","Ы"]},capslock:{en:!0,ru:!0}},{id:"KeyD",type:"symbol",value:{en:["d","D"],ru:["в","В"]},capslock:{en:!0,ru:!0}},{id:"KeyF",type:"symbol",value:{en:["f","F"],ru:["а","А"]},capslock:{en:!0,ru:!0}},{id:"KeyG",type:"symbol",value:{en:["g","G"],ru:["п","П"]},capslock:{en:!0,ru:!0}},{id:"KeyH",type:"symbol",value:{en:["h","H"],ru:["р","Р"]},capslock:{en:!0,ru:!0}},{id:"KeyJ",type:"symbol",value:{en:["j","J"],ru:["о","О"]},capslock:{en:!0,ru:!0}},{id:"KeyK",type:"symbol",value:{en:["k","K"],ru:["л","Л"]},capslock:{en:!0,ru:!0}},{id:"KeyL",type:"symbol",value:{en:["l","L"],ru:["д","Д"]},capslock:{en:!0,ru:!0}},{id:"Semicolon",type:"symbol",value:{en:[";",":"],ru:["ж","Ж"]},capslock:{en:!1,ru:!0}},{id:"Quote",type:"symbol",value:{en:["'",'"'],ru:["э","Э"]},capslock:{en:!1,ru:!0}},{id:"Enter",type:"special",value:"Enter"}],row4:[{id:"ShiftLeft",type:"special",value:"Shift"},{id:"Backslash",type:"symbol",value:{en:["\\","|"],ru:["\\","/"]},capslock:{en:!1,ru:!1}},{id:"KeyZ",type:"symbol",value:{en:["z","Z"],ru:["я","Я"]},capslock:{en:!0,ru:!0}},{id:"KeyX",type:"symbol",value:{en:["x","X"],ru:["ч","Ч"]},capslock:{en:!0,ru:!0}},{id:"KeyC",type:"symbol",value:{en:["c","C"],ru:["с","С"]},capslock:{en:!0,ru:!0}},{id:"KeyV",type:"symbol",value:{en:["v","V"],ru:["м","М"]},capslock:{en:!0,ru:!0}},{id:"KeyB",type:"symbol",value:{en:["b","B"],ru:["и","И"]},capslock:{en:!0,ru:!0}},{id:"KeyN",type:"symbol",value:{en:["n","N"],ru:["т","Т"]},capslock:{en:!0,ru:!0}},{id:"KeyM",type:"symbol",value:{en:["m","M"],ru:["ь","Ь"]},capslock:{en:!0,ru:!0}},{id:"Comma",type:"symbol",value:{en:[",",","],ru:["б","Б"]},capslock:{en:!1,ru:!0}},{id:"Period",type:"symbol",value:{en:[".","."],ru:["ю","Ю"]},capslock:{en:!1,ru:!0}},{id:"Slash",type:"symbol",value:{en:["/","?"],ru:[".",","]},capslock:{en:!1,ru:!1}},{id:"ArrowUp",type:"arrow",value:"▲"},{id:"ShiftRight",type:"special",value:"Shift"}],row5:[{id:"ControlLeft",type:"special",value:"Ctrl"},{id:"Win",type:"special",value:"Win"},{id:"AltLeft",type:"special",value:"Alt"},{id:"Space",type:"symbol",value:" "},{id:"AltRight",type:"special",value:"Alt"},{id:"ControlRight",type:"special",value:"Ctrl"},{id:"ArrowLeft",type:"arrow",value:"◄"},{id:"ArrowDown",type:"arrow",value:"▼"},{id:"ArrowRight",type:"arrow",value:"►"}]};let t=[0,0],l=!1,a=!1,n=!1,s=localStorage.getItem("lang")||"en";const c=(e,l)=>{let{value:a}=e,[n,s]=t,c="";return[c,n,s]=n===s?s===a.length?r(a,l):u(a,l,n,s):s===a.length?i(a,l,n,s):y(a,l,n,s),p(e,n,s),c},o=(e,l)=>{let{value:a}=e,[n,s]=t,c="";switch(l){case"Tab":[c,n,s]=n===s?s===a.length?r(a,"\t"):u(a,"\t",n,s):s===a.length?i(a,"\t",n,s):y(a,"\t",n,s);break;case"Enter":[c,n,s]=n===s?s===a.length?r(a,"\n"):u(a,"\n",n,s):s===a.length?i(a,"\n",n,s):y(a,"\n",n,s);break;case"Backspace":n===s?s===a.length?(c=a.slice(0,a.length-1),n=s=c.length):(c=a.slice(0,n-1)+a.slice(s),n=s-=1):s===a.length?(c=a.slice(0,n),n=s=c.length):(c=a.slice(0,n)+a.slice(s),s=n);break;case"Delete":n===s?s===a.length?(c=a,n=s=a.length):(c=a.slice(0,n)+a.slice(s+1),n=s):s===a.length?(c=a.slice(0,n),n=s=c.length):(c=a.slice(0,n)+a.slice(s),s=n);break;case"ArrowUp":return a+"▲";case"ArrowRight":return a+"►";case"ArrowDown":return a+"▼";case"ArrowLeft":return a+"◄";default:return a}return p(e,n,s),c},r=(e,t)=>{let l=e+t;return[l,l.length,l.length]},u=(e,t,l,a)=>[e.slice(0,l)+t+e.slice(a),l=a+=1,a],i=(e,t,l,a)=>[e.slice(0,l)+e.slice(a)+t,e.length,e.length],y=(e,t,l,a)=>{let n=e.slice(0,l)+t+e.slice(a,e.length);return a=l+=1,[n,l,a]},p=(e,t,l)=>setTimeout((()=>e.setSelectionRange(t,l))),d=()=>{const t=document.getElementsByClassName("key");Array.from(t).map((t=>{const l=t.parentElement.classList[1],a=e[l].find((e=>e.id===t.id));t.innerText=m(a)}))},m=({id:e,type:t,capslock:n,value:c})=>{let o=l?1:0;return a?(o=o?0:1,"symbol"===t&&"Space"!==e||"object"==typeof c?c[s][o]:c.toUpperCase()):"symbol"===t&&"Space"!==e?n[s]?c[s][o]:c[s][0]:"object"==typeof c?c[s][o]:c.toUpperCase()},v=(e,t)=>t?e.classList.toggle("key--active"):e.classList.remove("key--active"),k=e=>{const t=document.getElementsByClassName("key--active");Array.from(t).map((t=>t.id.includes(e)?t.classList.remove("key--active"):t))};window.onload=()=>{(()=>{const e=document.createElement("main");document.body.appendChild(e);const t=document.createElement("h1");t.innerHTML="Virtual Keyboard (Windows)",e.appendChild(t);const l=document.createElement("p");l.innerHTML="Для переключения языка комбинация: Ctrl + Shift",e.appendChild(l);const a=document.createElement("div");a.classList.add("display"),e.appendChild(a);const n=document.createElement("textarea");n.classList.add("screen"),a.appendChild(n);const s=document.createElement("div");s.classList.add("keyboard"),e.appendChild(s)})(),((t=Object.keys(e))=>{t.map((l=>{const a=document.createElement("div");a.classList.add("keyboard__row",l),((e,t)=>{t.map((t=>{const l=document.createElement("span");l.id=t.id,l.classList.add("key","key__"+t.type),l.innerHTML="object"==typeof t.value?t.value[s][0]:t.value.toUpperCase(),e.appendChild(l)}))})(a,e[l]),t[t.length-1]===l&&(e=>{const t=document.createElement("span");t.id="Plug",e.appendChild(t)})(a),document.getElementsByClassName("keyboard")[0].appendChild(a)}))})();const r=document.getElementsByClassName("keyboard")[0],u=document.getElementsByClassName("screen")[0],i=document.getElementById("CapsLock");u.focus(),document.addEventListener("keydown",(e=>{t=[e.target.selectionStart,e.target.selectionEnd],e.ctrlKey&&e.shiftKey?(s="en"===s?"ru":"en",d()):((e=>{e.preventDefault();const{key:t}=e,l=document.getElementsByClassName("screen")[0];l.value=t.length<2?c(l,t):o(l,t)})(e),document.getElementById(e.code).classList.toggle("key--active"),u.focus(),console.log("keydown: ",t))})),document.addEventListener("keyup",(e=>{const t=document.getElementById(e.code);e.getModifierState("CapsLock")?(l=!0,d()):(l=!1,d()),"CapsLock"!==t.id&&t.classList.remove("key--active")})),i.addEventListener("keydown",(()=>{i.classList.toggle("key--active")})),u.addEventListener("click",(e=>{e.stopPropagation(),t=[e.target.selectionStart,e.target.selectionEnd],console.log("click: ",t)})),r.addEventListener("click",(r=>{r.stopPropagation(),t=[u.selectionStart,u.selectionEnd],(t=>{t.preventDefault();const r=document.getElementsByClassName("screen")[0],u=e=>e.find((e=>t.target.id===e.id)),i=Object.keys(e).filter((t=>u(e[t])))[0];if(!i)return r;const y=u(e[i]);"arrow"===y.type?(n=!1,k("Control"),r.value=o(r,y.id)):"CapsLock"===y.id?(l=!l,n=!1,d(),k("Control"),v(t.target,l)):y.id.includes("Shift")?(n?(s="en"===s?"ru":"en",n=!1,k("Control"),localStorage.setItem("lang",s)):a=!a,d(),v(t.target,a)):y.id.includes("Control")?(a=!1,n=!n,d(),v(t.target,n),k("Shift")):(n=!1,k("Control"),r.value="symbol"!==y.type?o(r,y.value):c(r,m(y)),"symbol"===y.type&&a&&(a=!1,k("Shift"),d()))})(r),u.focus()}))}})();